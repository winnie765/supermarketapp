<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Successful</title>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body class="bg-light">
    <% const showSearch = false; %>
    <%- include('partials/nav', { user, showSearch }) %>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-sm text-center">
                    <div class="card-header">
                        <div class="text-uppercase small text-muted">PayPal</div>
                        <div class="fw-semibold">Payment Status</div>
                    </div>
                    <div class="card-body">
                        <h1 class="h4 mb-2"><%= message %></h1>
                        <p class="text-muted">Thank you for your payment!</p>
                        <img src="../images/greenTick.png" class="img-fluid my-3" style="max-width: 320px;" alt="Payment Successful" />
                        <div class="text-uppercase fw-semibold text-success">Payment Successful</div>
                        <div class="mt-4 d-flex flex-wrap justify-content-center gap-3">
                            <a id="paypal-view-invoice" href="/invoice" class="btn btn-lg btn-success rounded-pill px-4 py-2 text-uppercase fw-semibold" target="_top">View Invoice</a>
                            <a id="paypal-track-order" href="/orders/<%= order.invoiceNumber %>/track" class="btn btn-lg btn-outline-success rounded-pill px-4 py-2 text-uppercase fw-semibold" target="_top">Track Order</a>
                            <a id="paypal-back-shopping" href="/home" class="btn btn-lg btn-outline-success rounded-pill px-4 py-2 text-uppercase fw-semibold" target="_top">Back to Shopping</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function() {
            const invoiceBtn = document.getElementById('paypal-view-invoice');
            const trackBtn = document.getElementById('paypal-track-order');
            const shoppingBtn = document.getElementById('paypal-back-shopping');
            const navigate = (href) => {
                try {
                    if (window.top && window.top.location) {
                        window.top.location.href = href;
                        return;
                    }
                } catch (err) {
                    // cross-origin, fall back to same window
                }
                window.location.href = href;
            };
            if (invoiceBtn) {
                invoiceBtn.addEventListener('click', (event) => {
                    event.preventDefault();
                    navigate('/invoice');
                });
            }
            if (trackBtn) {
                trackBtn.addEventListener('click', (event) => {
                    event.preventDefault();
                    navigate('/orders/<%= order.invoiceNumber %>/track');
                });
            }
            if (shoppingBtn) {
                shoppingBtn.addEventListener('click', (event) => {
                    event.preventDefault();
                    navigate('/home');
                });
            }
        })();
    </script>
</body>
</html>
