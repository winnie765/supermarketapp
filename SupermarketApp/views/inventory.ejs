<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>
<body class="home-page">
  <%- include('partials/nav', { user }) %>
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center">
      <h3 class="mb-0 fw-bold">Inventory</h3>
      <a href="/admin" class="btn btn-warning btn-lg">Back to Dashboard</a>
    </div>
    <hr>
    <% if (messages && messages.error && messages.error.length) { %>
      <div class="alert alert-danger"><%= messages.error.join(', ') %></div>
    <% } %>
    <table class="table table-sm table-striped align-middle">
      <thead>
        <tr>
          <th>ID</th><th>Image</th><th>Name</th><th>Price</th><th>Stock</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% (products || []).forEach(p => { %>
          <% 
            const raw = (p.image || '').replace(/\\/g, '/').trim();
            const cleaned = raw.replace(/^public\//i, '').replace(/^\/?images\//i, '');
            const hasProtocol = /^https?:\/\//i.test(raw);
            const imgSrc = raw ? (hasProtocol ? raw : `/images/${cleaned || raw}`) : '/images/ShoppingCart.png';
          %>
          <tr>
            <td><%= p.id %></td>
            <td style="width: 90px;">
              <img src="<%= imgSrc %>" alt="<%= p.name %>" class="img-thumbnail" style="max-width: 80px; max-height: 80px; object-fit: contain;">
            </td>
            <td><%= p.name %></td>
            <td>$<%= Number(p.price||0).toFixed(2) %></td>
            <td><%= p.stock != null ? p.stock : '-' %></td>
            <td>
              <a href="/updateProduct/<%= p.id %>" class="btn btn-sm btn-warning">Edit</a>
              <a href="/inventory/delete/<%= p.id %>" class="btn btn-sm btn-danger">Delete</a>
            </td>
          </tr>
        <% }) %>
        <% if (!(products && products.length)) { %>
          <tr><td colspan="5" class="text-muted">No products.</td></tr>
        <% } %>
      </tbody>
    </table>
    <a href="/addProduct" class="btn btn-primary btn-lg">Add Product</a>
  </div>
</body>
</html>
